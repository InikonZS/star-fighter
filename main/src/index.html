<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="styles/style_.css"> -->
    <link rel="stylesheet" href="styles/style_2.css"> 
    <link rel="stylesheet" href="styles/gamemenu.css">
    <link rel="stylesheet" href="styles/bar-indicator.css">
    <link rel="stylesheet" href="styles/game-screen.css">
    <link rel="stylesheet" href="styles/gm-screen.css">
    <link href="https://fonts.googleapis.com/css2?family=Jura:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>Document</title>
</head>
<body>
    <header  id="app-header" class="header">
        <div class="wrapper header__wrapper">
 
          <nav class="header__navigation burger">
            <div class="hamburger burger hamburger__rotate" style=" position: absolute;  z-index: 12; opacity: 1; margin-bottom: 14px; ">
              <span class="hamburger__line"></span>
            </div>
            <h1 class="header__title">
              <a class="logo" href="#">
              <span style="color: rgb(124, 110, 248);">S</span>tar
              <span style="color: rgb(124, 110, 248);">F</span>ighter
              </a>
              </h1>
              <span class="hamburger__title" id="hidden__title" style="animation: 1.3s ease 0s 1 normal forwards running navLinkFade;"></span>
            <div class="navigation">
             <ul id="menu" class="nav__links active">
             <li class="header__menu active">
              <a class="navigation__link active" href="#app-main">Game</a>
             </li>
            <li class="header__menu">
             <a class="navigation__link" href="#gameplay">Gameplay</a>
             </li>
            <li class="header__menu">
              <a class="navigation__link" href="#project">Project</a>
            </li>
            <li class="header__menu">
              <a class="navigation__link" href="#team">Team</a>
            </li>
            <li class="header__menu">
              <a class="navigation__link" href="#develop">Development</a>
            </li>
            <li class="header__menu">
              <a class="navigation__link" href="#problems">Problems</a>
            </li>        
          </ul>
            </div>
          <div class="navigation__burger"></div> 
          </nav>  
        </div>
        </header>       
        <main class="center">
        <section id="app-mainnaxui" class="wrapper center__wrapper">
            <div class="game__container">  
            <div class="control__container">
            <div class="contol__text">
                <h4>Управление:</h4>
                <ul class="control__list">
                <li><b>W</b> - ускорение;&nbsp;</li>
                <li><b>Q</b> - вращение влево;&nbsp;</li>
                <li><b>E</b> - вращение вправо;&nbsp;</li>
                <li><b>AD</b> - смещение в сторону;&nbsp;</li>
                <li><b>S</b> - тормоз;&nbsp;</li>
                <li><b>1 2 3 4</b> - смена пушек;&nbsp;</li>
                <li><b>клик</b> - стрелять;&nbsp;</li>
                <li><b>space(пробел)</b> - щит;&nbsp;</li>
                <li><b>` (обратная кавычка), ё</b> - выход в меню, пауза;&nbsp;</li>
                <li><b>esc</b> - выход из полноэкранного режима.</li>
            </ul>
            </div> 
          </div>            
            <div class="game__panel">
                <div id="app-main" ></div>
            </div>
        </div>
        </section>
        <div class="line"></div>
        <section class="gameplay" id="gameplay">
          <div class="wrapper gameplay__wrapper">
            <div class="titleGameplay__container">
            <div class="gameplay__row">             
              <h2 class="team__title">Gameplay and screenshot</h2>
              <p class="team__text"></p>  
              <div class="gameplay__container">        
              <div class="gameplay__img"><img class="gameplay__screen" src="../assets/image/Desktop Screenshot 2020.07.19 - 22.09.34.55.png"><img class="gameplay__screen" src="../assets/image/Desktop Screenshot 2020.07.19 - 22.09.02.23.png"><img class="gameplay__screen" src="../assets/image/Desktop Screenshot 2020.07.19 - 22.06.22.98.png"></div>
              <div class="" slot="youtube" playlist="" autoplay="0" controls="1" rel="0" annotations="1" hide-info="0" button-color="dark" status="paused" allowfullscreen="">   
                  <iframe class="gameplay__style" src="https://www.youtube.com/embed/MdCXArvHt9U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
              </div>
                
            
            </div> 
            </div>
            </div>
          </div>
        </section>
        <div class="line"></div>
        <section class="project" id="project">
          <div class="wrapper project__wrapper">
            <div class="titleProject__container">
            <div class="title__row">             
              <h2 class="team__title">Project description</h2>
              <div class="team__text">
                  <p>Собственно что реализовано в проекте:</p>
                  <p>По сути это игрушка в которой можно летать в космосе среди разных обьектов, метеоритов, космического мусора, стрелять по вражеским кораблям, который так же стреляют в ответ. Так же игрок не может пройти сквозь препятствие, в некоторых типах препятствий отнимается здоровье. Ограничено количество боеприпасаов, можно переключать оружие (4 вида, разные характеристики), можно собирать бонусы здоровья и боеприпасов. В игре присутствует несколько миссий, у миссий есть цели, они отображаются в игре и помечаются как пройденные или проваленые, выполнение определенной цели приводит к завершению миссии с победным звуком и экраном, так же возможен провал в случае уничтожения корабля игрока, в таком случае происходит выход в меню. В игре есть несколько миссий, они не особо продуманные, но демонстрируют возможности движка и геймплей. Так же перед запуском миссии выбирается один из доступных кораблей, каждый корабль имеет свою модель и модель внутреннего вида.
                  </p>
                  <p>
                  Управление в игре на кнопки W - вперед, QE вращение в бока, AD смещение в стороны, 1234 - выбор оружия, пробел - щит, клик - стрелять, esc - выход из полноэкранного режима, ё - пауза, меню. Так же дублируется экранным джойстиком для мобильных устройств.
                  </p>
                  <p>
                  На данный момент сохранено несколько версий игры от начала проекта, а так же предварительно написанная стрелялка до начала данного проекта. В последнюю версию к сожалению не удалось внедрить некоторые фичи предпоследней.  
                  </p>
                  <p>
                    Так же доступны старые версии: 
                  </p>
                  <ul>
                  <li><a href='https://practical-mayer-0002e6.netlify.app/'>Начало, первые эксперименты</a></li>
                  <li><a href='https://focused-bhabha-27dba6.netlify.app/'>Уже взлетели</a></li>
                  <li><a href='https://practical-shirley-07f531.netlify.app/'>Уже новый движок</a></li>
                  <li><a href='https://wizardly-cori-04e4d5.netlify.app/'>Прелоадинг и мобильная версия, какой-то дизайн</a></li>
                  <li><a href='https://jovial-noether-b4614a.netlify.app/'>Почти готово</a></li>
                  </ul>
              </div>
            </div>
            </div>
          </div>
        </section>
        <div class="line"></div>
        <section class="team" id="team">
          <div class="wrapper team__wrapper">
            <div class="titleTeam__container">
            <div class="title__row">             
              <h2 class="team__title">Team Member</h2>
              <h2 class="team__title">Organization of the development process</h2>
                <p class="team__text">Для распределения обязанностей и контроля над качеством и правильностью кода в команде должны присутствовать старшие или более опытные разработчики, в обязанности которых входит обсуждение функционала, постановка задачи и реализация и/или проверка написанного кода.
                  Т.е. должен быть  тимлид, который осуществляет распределение частей проекта между старшими разработчиками, просмотр кода, отслеживает сроки выполнения заданий, а так же создание новых при необходимости. 
                  <br>У нас в проекте тимлида не было и процесс разработки  осуществлялся двумя разработчиками с разным уровнем знаний в программировании(т.е. был старший разработчик и младший разработчик). Поэтому, было решено делать всё  на основе кода более опытного разработчика, т.е. младший разработчик пытался разобраться в коде старшего разработчика и на основе его кода сделать что-то своё в проекте. 
                  <br>Так как старший разработчик и младший разработчик работали в одних и тех же файлах, то для того, чтоб не было конфликтов при работе с github,  было решено работать в разных ветках. Ветка старшего разработчика считалась основной, а младший разработчик  должен был периодически клонировать ветку старшего разработчика и продолжать работать в клонированной ветке. В свою очередь старший разработчик забирал в свою ветку изменения из ветки младшего разработчика. 
                  <br>Старший разработчик работал над созданием движка игры и частично над вёрсткой (окно с игрой), над фичами. Младший разработчик также пытался реализовать фичи (например, аудиоплеер), создавал 3d-модели в 3ds max и делал текстуры для них, придумывал миссии и загружал модели в миссию 3, а также занимался вёрсткой (делал лендинг игры). (с)Младший разработчик. 
                  </p>
                  <p class ="team__text">На самом деле я много накосячил с гитом, надо было всетаки потиху в мастер сливать хороший код, и мержить было бы проще в таком случае. В целом младший разработчик крут. (с) Старший разработчик</p>
            </div>
            </div>
              <div class="titleTeam__container">
                  <div class="employee">
                      <div class="employee__content">
                          <div class="background__employee"><img src="../assets/image/Alena.jpg"
                                  alt="employee photo"></div>
                          <h3 class="employee__title">Alena Rebkavets</h3>
                          <p class="employee__text">Начинающий frontend developer. Опыт в программировании: 6 месяцев. Высшее образование. Профессия: архитектор-визуализатор. Опыт работы в сфере проектирования зданий и сооружений: 9 лет. (+2 года чиновник).</p>
                              <div class="video__container" slot="youtube" playlist="" autoplay="0" controls="1" rel="0" annotations="1" hide-info="0" button-color="dark" status="paused" allowfullscreen="">   
                                <iframe class="video" src="https://www.youtube.com/embed/UHleaF74ET4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen  width="100%" height="200px"></iframe>
                              </div>
                              <div class="services__icon">
                                <a href="https://www.facebook.com/alena.rebkavets.3" class="ico"><img src="../assets/icons/Facebook.png" alt="icon facebook"></a>
                                <a href="#" class="ico"><img src="../assets/icons/Google.png" alt="icon google"></a>
                                <a href="#" class="ico"><img src="../assets/icons/LinkedIn.png" alt="icon linkedin"></a>
                                <a href="https://github.com/Ragneda" class="ico"><img src="../assets/icons/Github.png" alt="icon Github"></a>
                              </div>                            
                      </div>
                    </div>
                  <div class="employee">
                      <div class="employee__content">
                          <div class="background__employee"><img src="../assets/image/Zhan.jpg"
                                  alt="employee photo"></div>
                          <h3 class="employee__title">Zhan Zhuridov</h3>
                          <p class="employee__text">Frontend developer. Engineer of electronics. More 10 years of programming experience.</p>
                              <div class="video__container" slot="youtube" playlist="" autoplay="0" controls="1" rel="0" annotations="1" hide-info="0" button-color="dark" status="paused" allowfullscreen="">   
                                <iframe class="video" src="https://www.youtube.com/embed/EKZyy282qIc" frameborder="0" width="100%" height="200px" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                              </div>
                              
                          <div class="services__icon">
                            <a href="#" class="ico"><img src="../assets/icons/Facebook.png" alt="icon facebook"></a>
                            <a href="#" class="ico"><img src="../assets/icons/Google.png" alt="icon google"></a>
                            <a href="https://www.linkedin.com/in/inikon" class="ico"><img src="../assets/icons/LinkedIn.png" alt="icon linkedin"></a>
                            <a href="https://github.com/InikonZS" class="ico"><img src="../assets/icons/Github.png" alt="icon Github"></a>
                          </div>
                      </div>
                    </div>                
              </div>
          </div>
        </section>
          <div class="line"></div>
          
          <div class="line"></div>
          <section class="problems" id="problems">
            <div class="wrapper problems__wrapper">
              <div class="titleProblems__container">
              <div class="title__row">             
                <h2 class="team__title">Technical problems</h2>
                <div class="team__text">
                    Основными сложностями в проекте можно называть:
                    <ul>
                      <li>1. Требования к производительности</li>
                      <li>2. Необходимость учитывать медленное соединение с интернетом</li>
                      <li>3. Объем кода</li>
                      <li>4. Длительность тестирования</li>
                      <li>5. Математическая сложность</li>
                    </ul>
                    <h3>1. Требования к производительности</h3>
                    <p>
                    Требования к производительности для реалтайм графики один из самых сложных моментов, к тому же это был первый мой проект с использованием WebGL технологии. Типичный цикл web программирования заключается в создании, удалении объектов из DOM, навешивании обработчиков, смене аттрибутов элементов. Браузер при этом сам перерисовывает страницу и об этом не надо беспокоиться. В случае работы с canvas, в частности с контекстом webGL задача рендеринга с частотой 60 кадров в секунду ложится на разработчика. С такой скоростью JS может выполнять не так и много операций, ориентировочно цикл for с 30к - 100к итераций уже вызовет просадку fps. WebGL решает эту проблему при отрисовке сложных моделей шейдерами - специальными программами на языке GLSL, выполняемыми непосредственно на GPU. Так js вызывает лишь некоторые функции подготовки видеокарты к рендерингу, заполняет буферы, загружает текстуры, указывает необходимые шейдерные программы, устанавливает значения входных переменных шейдеров и наконец запрашивает отрисовку. Все эти действия так же занимают время, но далеко не все параметры надо устанавливать каждый кадр, на этом была построена одна из оптимизаций.
                    Другой момент - шейдеры не могут возвращать результат, результат их работы отображается на canvas. Конечно была идея попробовать прочитать отдельные пиксели для возможности вести расчеты через GPU, но задача показалась сложной и возникали некоторые сомнения. Таким образом было решено физику рассчитывать на JS, по сути выполнять тоже что делает вершинный шейдер.
                    
                    И так изобразим путь графических объектов от сервера до пользователя:
                    
                    Сервер - интернет - оперативная память (полученные Obj, png) - парсер obj - загрузка в видеопамять (буффер вершин, текстура, шейдер) - установка шейдера - установка буфера - установка трансформов - отрисовка.
                    
                    Из этих всех операций в реальном времени можно выполнять лишь последние 4. Но даже частая смена текстур и моделей и конечно же шейдеров времязатратно, поэтому было решено предварительно создать дерево рендеринга таким образом, что сначала устанавливается шейдер и рисуются все буферы с ним связанные, причем они могут отрисовываться несколько раз с разными матричными трансформами. Это дало значительный прирост к скорости.
                    
                    С физическими моделями и проверкой столкновений так же добавились сложности, ведь их надо рассчитывать каждый кадр тоже. Основная сложность в том, что рендеринг выполняется линейно для всех моделей, а физика считается квадратично, взаимодействие каждой с каждой. Но есть часть вычислений, которые можно предварительно рассчитать для каждой модели. Так выделилось 3 функции:
                    render - отрисовка
                    process - предварительный расчет физики
                    react - взаимодействие физических моделей
                     
                    Но объекты могут быть разных категорий, например пули взаимодействуют со всеми объектами, враги и игрок могут реагировать на столкновения с твердыми объектами, игрок может собирать бонусные объекты и чекпоинты. Поэтому аналогично рисовке, физические модели были представлены в виде списков для каждой категории.
                    
                    Получается один объект по сути мог находиться в разных списках, а иногда их требовалось удалять полностью. Так был создан базовый игровой объект, который можно было привязать к разным спискам для задания ему свойств, объект хранил ссылки на все списки в которых он находится и позволял удалять себя из всех. Некоторые объекты могут иметь собственные события например onHit, onKilled, onContact и принимать обработчики подобно dom объектам.		
                    
                    Таким образом многие проблемы с игровыми объектами были решены. Конечно медленность физических расчетов осталась, она требует более глубокого решения, например есть возможность использовать упрощенные модели для физики и более сложные для отрисовки и объединять их в класс. 
                    </p>
                    <h3>2. Необходимость учитывать медленное соединение с интернетом</h3>
                    <p>
                    Медленное соединение с интернетом проявило один из очень неприятных багов - задержка воспроизведения звуков выстрелов, столкновений, взрывов. Выглядело все не естественно
                    Так же возникала проблема с переключением миссий, происходила перезагрузка с сервера всех текстур и моделей. Так все внешние ресурсы было решено предварительно загрузить и хранить в Blob. Решение конечно тоже не очень, ресурсов стало много, загрузка длительной, при этом в выбранной миссии может не оказаться части загруженных объектов.
                    </p>
                    <h3>3. Объем кода</h3>
                    <p>
                    Проект оказался очень огромным, впервые мне удалось написать настолько много кода. В проекте около 50 рабочих js файла со средним числом строк около 100, при этом во время разработки код сильно менялся, 2 раза перестраивалась вся архитектура и много кода полностью переписывалось, таким образом ушло из проекта около 70 js файлов. Тем не менее продакшн сборка самого скрипта всего 150кб при наличии в нем кучи разных объектов, сложнейшей математики, кучи линков на внешние файлы. А это как размер одного слайдера из интернета.
                    
                    Проект развивался быстро, всегда хотелось получить результат, были случаи, что для возможности протестировать приходилось писать более 300 строк кода, промежуточные тесты были невозможны. Не всегда хотелось тратить время на написание хорошего кода для проверки фич, которые с некоторой вероятностью могли оказаться неработоспособными. Рефакторинг же приводил к тому, что изменений требовалось много по всему коду, и иногда это сразу не делалось, так накапливася легаси код, например обьекты в игру можно было добавлять как старыми методами так и новыми.
                    
                    Так же такой объем кода не был изначально сгруппирован по папкам, получалась каша, поиск нужных файлов занимал все больше времени, и все это приходилось держать в голове. Впринципе я весь месяц держал в голове весь код и всегда мог сказать в какой папке, в каком файле и на какой приблизительно строчке что можно найти.
                    
                    Тем не менее высокая связность модулей, разбросанность фич вносила сложности в редактирование и вытекает следующий пункт
                    </p>
                    <h3>4. Длительность тестирования</h3>
                    <p>
                    Данный пункт можно разбить на 3 подпункта
                    <ul>
                    <li>
                    а. большой объем приложения, длительный доступ к нужной странице или нужной позиции или ситуации в игре.
                    </li>
                    <li>
                    б. разбросанность кода требует вносить множество правок для испытания новой фичи
                    </li>
                    <li>
                    в. некоторые функции, например мультитач управление, фуллскрин требует испытания на настоящей мобиле, а не симуляторе.
                    </li>
                    </ul>
                   
                    Таким образом некоторые фичи реализовывались отдельно от общего кода, создавались наброски игровых меню, отдельная верстка, которая потом переносилась на существующие классы, привязывалась к логике приложения. Создавались специально тестовые расстановки объектов для испытания взаимодействий в игре.
                    </p>

                    <h3>5. Математическая сложность</h3>
                    <p>
                    Для многих уверен это может показаться странным, но да, создание 3d игр это чертовски сложная математика. Если быть кратким то рассмотрим пример, пусть у нас есть кубик и есть пуля летящая в него в виде точки по линейной траектории, и на все это смотрит камера и с нее мы видим изображение.
                    Так вот кубик состоит из 8 точек, обьединенных индексами в треугольники, каждая точка содержит как минимум 3 координаты, а так же может содержать нормали, текстурные координаты, другие параметры. Так вот попадание пули - результат решения уравнения плоскости каждого треугольника с параметрическим уравнением прямой траектории пули, с проверкой попадания решения этой системы одновременно в треугольник и отрезок для текущего перемещения за кадр. Допустим пуля должна отскочить, тогда требуется рассчитать новый вектор скорости повернутый на угол отражения относительно нормали треугольника, например через скалярное произведение вектора скорости и вектора нормали. А если смотреть на это все камерой, то для отображения на экране необходимо умножить все вершины этого куба на матрицу его трансформа, на матрицу трансформа камеры и на матрицу проекции. А пулю пересекать так же с трансформированным объектом зачастую надо. И это впринципе не сложно, в некоторых случаях используются экспоненты и логарифмы, но не чисел, а матриц, например для интерполяции трансформов при анимации. Иногда всего этого очень много.
                    </p>
                    
                    <h3>Итог:</h3>
                    <p>
                    Было сделано много, хоть можно было и лучше. Проект был просто пределом возможностей, вклад вносился ежедневно на протяжении более месяца, приходилось часто не спать, иногда нервы были на пределе, когда приходилось терять драгоценное время на деградационно-ориентированной работе.
                    
                    Важной фичей является адаптивность и кроссплатформенность. Приложение тестировалось в Firefox (основной), Chrome, а так же на мобиле тоже Chrome. Мобильная версия требовала свое управление в виде экранного джойстика. Так же адаптивности верстки всего сайта и игровых элементов. Использование мультитач потребовало переработать класс кнопки, onClick событие не работает с мультитачем, требуется обработка полностью touch событий. Так же mouseMove сильно отличается от touchMove. У второго довольно высокий порог срабатывания, так перемещение становится дерганым, поэтому решено было управлять не самим вращением камеры, а ее скоростью, так получилось играбельно. Так же много юзабельности дало полное заполнение экрана невидимыми чуствительными областями и размещение небольших иконок над ними. 
                    
                    В целом на копийность прототипа упор не делался, взята была основная тематика, развивалась отдельная игра со своей механикой, большим вниманием к мобильной версии, в связи с этим упрощением управления, адаптации игровых меню. 
                    Вроде что-то получилось.
                    </p>
                  </div>
              </div>
              </div>
            </div>
          </section>
        </section>
        <div class="line"></div>
        </main> 
        <!--<footer class="footer">
            <div class="wrapper footer__wrapper">
            <div class="footer__text"></div>
          </div>
          </footer> -->
          <script src="ext-utils/lending.js"></script>   
          <script src="ext-utils/m4.js"></script>
          <script src="script.js"></script>          
</body>
</html>